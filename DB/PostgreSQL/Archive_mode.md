# PostgreSQL: Archive mode

항상 PostgreSQL은 클러스터 데이터 디렉터리의 `pg_wal` 하위 디렉터리에 WAL(Write Ahead Log, 이하 WAL)을 유지한다.
WAL는 DB의 데이터 파일에 대한 모든 변경 사항을 기록한다.
WAL는 주로 충돌 안전 목적에 의해 존재한다.
시스템이 충돌하면 마지막 체크포인트 이후 만들어진 WAL 항목을 재생하여 DB를 일관성 있게 복원한다.
복구가 필요한 경우 파일 시스템 백업을 복원한 후 백업된 WAL 파일에서 재생해 시스템을 현재 상태로 복원할 수 있다.
이 접근 방식은 다른 접근 방식들보다 관리하기 복잡하나 몇 가지 이점이 있다.

-   출발점으로 완벽하게 일관된 파일 시스템 백업이 필요하지 않다.
    -   백업의 내부 불일치는 WAL 재생으로 수정(응급 복구와 동일한 방법)된다.
    -   파일 시스템 스냅샷 기능이 필요하지 않고 tar와 같은 아카이빙 툴만 있으면 가능하다.
-   재생을 위해 무한히 긴 WAL 파일 시퀀스를 결합할 수 있으므로 WAL 파일을 계속 보관하는 것만으로 연속 백업을 수행할 수 있다.
    -   전체 백업을 자주 수행하지 못하는 대규모 데이터베이스에서 더욱 유용하다.
-   복원할 때 WAL 파일의 내용을 끝까지 재실행할 필요가 없다.
    -   특정 시점에서 이 작업을 멈출 수 있다는 말이며, 특정 시점의 DB 상태로 복원이 가능하다.
-   다른 호스트에 베이스 백업을 복원해 놓고 운영 서버에서 만들어지는 WAL 파일들을 주기적으로 준비해둔 서버로 반영할 수 있다.
    -   위 운영 방법을 Warm standby 시스템 구축 기법이라고 한다.

pg_dump와 pg_dumpall은 파일 시스템 수준 백업을 생성하지 않으며 연속 아카이빙 솔루션의 일부로 사용할 수 없다.
이러한 덤프는 논리적이며 WAL 재생에서 사용하기에 충분한 정보를 포함하지 않는다.

일반 파일 시스템 백업 기술과 마찬가지로 이 방법은 하위 집합이 아닌 전체 데이터베이스 클러스터의 복원만 지원할 수 있다.
많은 아카이브 스토리지 또한 필요로 하기에 기본 백업은 부피가 클 수 있으며 사용량이 많은 시스템은 아카이브 해야하는 많은 량의 WAL 트래픽을 생성한다.
높은 안정성이 필요한 많은 상황에서 사용되는 백업 기술이다.

Continuous Archiving(이하 연속 아카이빙, 온라인 백업)을 사용하여 성공적으로 복구하려면 적어도 백업 시작 시간까지 확장되는 Archived WAL 파일의 연속 시퀀스가 필요하다.
